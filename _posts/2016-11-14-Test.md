---
layout: post
title: 我的第一篇博客
categories: [blog ]
tags: [生活, ]
description:  
---

地下城堡 发出骁勇的讯号 闪电飞驰呼啸 狂沙风暴 吞噬着骄傲

## 阿拉德勇士报到
当当当，意淫了好久的博客终于搭建成功啦，可以开始无疲劳刷图之旅咯~

## 为什么要搭建自己的博客
随着人的不断成长，思想也会不断发生变化。如果不把一瞬间的灵感纪录下来，很可能以后再也无法从记忆中找到它了。

*还记得今年国庆回家，由于距离比较远，ipad成为了很好的消遣工具，我在靠窗的位置上摆弄着为数不多的几个单机游戏，没有觉得有趣，也不觉得无聊。突然，一个小朋友叫了起来“哇，是流浪汉！”，我看看自己手里的pad，没错，他是看到了我正在玩的一个关于流浪汉的街机游戏。我还没反应过来，他已经走到了我的旁边，看着我玩了起来。这下我也来了劲，开始使用各种打法给他演示，他居然激动地喊了起来，虽然具体喊得内容已经记不得了，但是我能感受到的是他当时对游戏的热情已经远远超过了我这个"身经百战"的“蜀黍”。*

*看着他这么有兴趣，我索性把pad给了他去一边摆弄，没过一小会，一群小朋友已经围在了一起。他们充满激情地围在一个屏幕前面讨论着放什么技能、打哪个怪。我却陷入了沉思*

*是啊，小时候的我也是这么有趣的人呢，可是那种感觉再也找不到了。成熟了，也失去了。*

{% highlight C++ linenos %}
#include "main.h"
#include "SimulatorWin.h"
#include <shellapi.h>

#include <atlbase.h>
#include <atlstr.h>
#include <strsafe.h>
#include <DbgHelp.h>
#pragma comment(lib,"DbgHelp.lib")
#define GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS        (0x00000004)
#define MiniDumpWithThreadInfo 0x1000

typedef BOOL(WINAPI *PGetModuleHandleEx)(DWORD dwFlags, LPCTSTR lpModuleName, HMODULE *phModule);

VOID CreateDump(struct _EXCEPTION_POINTERS *pExceptionPointers)
{
    //收集信息
    CStringW strBuild;
    strBuild.Format(L"Build: %s %s", __DATE__, __TIME__);
    CString strError;
    HMODULE hModule;
    WCHAR szModuleName[MAX_PATH] = { 0 };

    PGetModuleHandleEx pFun = (PGetModuleHandleEx)GetProcAddress(GetModuleHandle(L"kernel32.dll"), "GetModuleHandleExW");
    if (!pFun) {
        return;
    }

    pFun(GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS, (LPCWSTR)pExceptionPointers->ExceptionRecord->ExceptionAddress, &hModule);
    GetModuleFileName(hModule, szModuleName, ARRAYSIZE(szModuleName));
    strError.Format(L"%s %d , %d ,%d.", szModuleName, pExceptionPointers->ExceptionRecord->ExceptionCode, pExceptionPointers->ExceptionRecord->ExceptionFlags, pExceptionPointers->ExceptionRecord->ExceptionAddress);

    //生成 mini crash dump
    BOOL bMiniDumpSuccessful;
    WCHAR szPath[MAX_PATH];
    WCHAR szFileName[MAX_PATH];
    WCHAR* szAppName = L"DumpFile";
    WCHAR* szVersion = L"v1.0";
    DWORD dwBufferSize = MAX_PATH;
    HANDLE hDumpFile;
    SYSTEMTIME stLocalTime;
    MINIDUMP_EXCEPTION_INFORMATION ExpParam;
    GetLocalTime(&stLocalTime);
    GetTempPath(dwBufferSize, szPath);
    StringCchPrintf(szFileName, MAX_PATH, L"%s%s", szPath, szAppName);
    CreateDirectory(szFileName, NULL);
    StringCchPrintf(szFileName, MAX_PATH, L"%s%s//%s-%04d%02d%02d-%02d%02d%02d-%ld-%ld.dmp",
        szPath, szAppName, szVersion,
        stLocalTime.wYear, stLocalTime.wMonth, stLocalTime.wDay,
        stLocalTime.wHour, stLocalTime.wMinute, stLocalTime.wSecond,
        GetCurrentProcessId(), GetCurrentThreadId());
    hDumpFile = CreateFile(szFileName, GENERIC_READ | GENERIC_WRITE,
        FILE_SHARE_WRITE | FILE_SHARE_READ, 0, CREATE_ALWAYS, 0, 0);

    MINIDUMP_USER_STREAM UserStream[2];
    MINIDUMP_USER_STREAM_INFORMATION UserInfo;
    UserInfo.UserStreamCount = 1;
    UserInfo.UserStreamArray = UserStream;
    UserStream[0].Type = CommentStreamW;
    UserStream[0].BufferSize = strBuild.GetLength()*sizeof(WCHAR);
    UserStream[0].Buffer = strBuild.GetBuffer();
    UserStream[1].Type = CommentStreamW;
    UserStream[1].BufferSize = strError.GetLength()*sizeof(WCHAR);
    UserStream[1].Buffer = strError.GetBuffer();

    ExpParam.ThreadId = GetCurrentThreadId();
    ExpParam.ExceptionPointers = pExceptionPointers;
    ExpParam.ClientPointers = TRUE;

    MINIDUMP_TYPE MiniDumpWithDataSegs = (MINIDUMP_TYPE)(MiniDumpNormal
        | MiniDumpWithHandleData
        | MiniDumpWithUnloadedModules
        | MiniDumpWithIndirectlyReferencedMemory
        | MiniDumpScanMemory
        | MiniDumpWithProcessThreadData
        | MiniDumpWithThreadInfo);

    bMiniDumpSuccessful = MiniDumpWriteDump(GetCurrentProcess(), GetCurrentProcessId(),
        hDumpFile, MiniDumpWithDataSegs, &ExpParam, NULL, NULL);

    return;
}

LONG WINAPI DumpCallback(_EXCEPTION_POINTERS* excp)
{
    CreateDump(excp);
    return EXCEPTION_EXECUTE_HANDLER;
}

int APIENTRY _tWinMain(HINSTANCE hInstance,
	HINSTANCE hPrevInstance,
	LPTSTR    lpCmdLine,
	int       nCmdShow)
{
    SetUnhandledExceptionFilter(DumpCallback);
	UNREFERENCED_PARAMETER(hPrevInstance);
	UNREFERENCED_PARAMETER(lpCmdLine);
    auto simulator = SimulatorWin::getInstance();
    return simulator->run();
}

{% endhighlight %}

## 关于我
* 属性：非二次元猿类
* 性别：雄性
* 爱好：程序、游戏、音乐、大自然
* 梦想：建造出新的阿拉德大陆

## 想说的话
是的，你猜对了：

"hello world"

